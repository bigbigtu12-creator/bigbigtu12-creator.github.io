<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>每日一诗（整首）</title>
  <style>
    :root { color-scheme: light dark; }
    html,body{margin:0;padding:0;background:transparent}
    .card{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,system-ui,"PingFang SC","Helvetica Neue",Arial;
      padding:16px 18px; line-height:1.8; color:#111; max-width:680px
    }
    @media (prefers-color-scheme: dark){
      .card{ color:#eee }
    }
    .title{ font-size:18px; font-weight:600; margin-bottom:4px }
    .meta{ color:#666; font-size:14px; margin-bottom:10px }
    @media (prefers-color-scheme: dark){
      .meta{ color:#aaa }
    }
    .poem{ white-space:pre-wrap; font-size:17px }
    .footer{ color:#888; font-size:12px; margin-top:14px }
  </style>
</head>
<body>
  <div class="card">
    <div id="title" class="title">加载中…</div>
    <div id="meta" class="meta"></div>
    <div id="poem" class="poem"></div>
    <div class="footer">数据来源：今日诗词</div>
  </div>
  <script>
    async function loadPoem(){
      try{
        // 今日诗词跨域友好，浏览器直接请求
        const r = await fetch('https://v2.jinrishici.com/one.json', { credentials: 'include' });
        if(!r.ok) throw new Error('网络错误：' + r.status);
        const j = await r.json();
        const d = j?.data || {};
        const origin = d?.origin || {};

        // 标题、作者、朝代
        const title = origin?.title || '';
        const author = origin?.author || '';
        const dynasty = origin?.dynasty || '';

        // 整首诗优先：origin.content 是整首的分行数组（有些是 paragraphs）
        let lines = [];
        if (Array.isArray(origin?.content) && origin.content.length){
          lines = origin.content;
        } else if (Array.isArray(origin?.paragraphs) && origin.paragraphs.length){
          lines = origin.paragraphs;
        } else if (typeof d?.content === 'string' && d.content.trim()){
          // 回退：只有一句时也展示
          lines = [d.content.trim()];
        }

        // 渲染
        document.getElementById('title').textContent = title || '每日一诗';
        const metaParts = [dynasty, author].filter(Boolean);
        document.getElementById('meta').textContent = metaParts.join(' · ');
        document.getElementById('poem').textContent = lines.join('\n');

      }catch(e){
        document.getElementById('title').textContent = '加载失败';
        document.getElementById('meta').textContent = '';
        document.getElementById('poem').textContent = '请稍后重试。';
        console.error(e);
      }
    }
    loadPoem();
  </script>
</body>
</html>
